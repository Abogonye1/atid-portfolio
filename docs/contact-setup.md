# Contact Form: Supabase + Resend Setup

This project uses a Supabase Edge Function (`contact`) to store messages in `public.contacts` and send emails via Resend.

## 1) Frontend env (.env.local)

Create `mirage-hero-forge-21482-main/.env.local` with:

```
VITE_SUPABASE_URL=https://fsgxwaylkjlgbtmqmmfc.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzZ3h3YXlsa2psZ2J0bXFtbWZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMTk3NzAsImV4cCI6MjA3NzU5NTc3MH0.8PxPJ5umfOx9GRKsN148W5dT-7pTM_Q5ZEzgpi5PSHQ
```

Restart the dev/preview server after changing envs.

## 2) Supabase CLI: link and secrets

Run these in PowerShell from the app root: `c:\Users\USER\Documents\mirage-hero-forge-21482-main\mirage-hero-forge-21482-main`.

```
npx supabase login
npx supabase link --project-ref fsgxwaylkjlgbtmqmmfc

npx supabase secrets set \
  RESEND_API_KEY="sb_publishable_usJHaQ_YRtQOirQvJBu8Lw_p5mf7TYS" \
  SUPABASE_URL="https://fsgxwaylkjlgbtmqmmfc.supabase.co" \
  SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzZ3h3YXlsa2psZ2J0bXFtbWZjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjAxOTc3MCwiZXhwIjoyMDc3NTk1NzcwfQ.tLm-Or4xY_XVEPlXbCgrKTyJq5TWCz1B6TZhcoW_Mak"
```

Notes:
- The function is patched to use `SUPABASE_SERVICE_ROLE_KEY` for secure inserts under RLS.
- `RESEND_API_KEY` should be a Resend secret key; if this value is publishable, email sending will fail. Replace with your Resend secret from the Resend dashboard.
- Update the `from` address inside the function to a verified domain before going live.

## 3) Deploy the Edge Function

```
npx supabase functions deploy contact
npx supabase functions list
```

Your function URL will be:

```
https://fsgxwaylkjlgbtmqmmfc.functions.supabase.co/contact
```

## 4) Database table

Create `public.contacts` (via SQL editor in Supabase):

```sql
create table if not exists public.contacts (
  id bigint generated by default as identity primary key,
  name text not null,
  email text not null,
  message text not null,
  created_at timestamptz default now()
);

-- RLS optional; service_role bypasses RLS by design
alter table public.contacts enable row level security;
```

## 5) Test

PowerShell:

```
$body = @{ name = "Test User"; email = "test@example.com"; message = "Hello from CLI" } | ConvertTo-Json
Invoke-WebRequest -Uri 'https://fsgxwaylkjlgbtmqmmfc.functions.supabase.co/contact' -Method POST -ContentType 'application/json' -Body $body
```

App UI:
- Open your preview at `http://localhost:4174/contact`
- Submit the form; expect a success toast, a DB insert, and two emails (admin + confirmation).

## 6) Resend domain

- For production emails, set `from: 'NomadIQ <noreply@your-verified-domain>'` in the function and verify your domain in Resend.
- Current code uses `onboarding@resend.dev` as a safe default for initial testing.
## Contact submission timeout

You can control the client-side timeout for the contact form submission via an environment variable:

- `VITE_CONTACT_TIMEOUT_MS` â€” number of milliseconds to wait before showing a timeout toast.

Defaults to `12000` (12s). During tests, the app uses a short timeout to keep tests fast.

Example `.env.local` entry:

```
VITE_CONTACT_TIMEOUT_MS=15000
```